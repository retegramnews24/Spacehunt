<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spacehunt</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            border: 3px solid #003366;
            background: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
        }

        #startButton {
            padding: 20px 40px;
            font-size: 24px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s;
            font-family: Arial, sans-serif;
        }

        #startButton:active {
            transform: scale(0.95);
        }

        .image-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
        }

        .centered-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
        }

        .stars-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s;
        }

        .star-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
        }

        #spaceship {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #ff9900;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            box-shadow: 0 0 10px #ff9900;
            z-index: 100;
            display: none;
            cursor: move;
            transition: transform 0.1s;
        }

        #spaceship::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ffcc00;
            border-radius: 50%;
            top: 10px;
            left: 10px;
        }

        /* Animazioni */
        @keyframes expandAndFade {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            70% {
                transform: scale(3);
                opacity: 0.8;
            }
            100% {
                transform: scale(5);
                opacity: 0;
            }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .expanding {
            animation: expandAndFade 3s ease-in-out forwards;
        }

        .visible {
            opacity: 1 !important;
        }

        /* Previene lo zoom su doppio tap */
        * {
            touch-action: manipulation;
        }
    </style>
</head>
<body>
    <button id="startButton">START</button>
    
    <div class="image-container" id="imageContainer">
        <img src="https://raw.githubusercontent.com/retegramnews24/Spacehunt/main/square.PNG" 
             alt="Spacehunt" 
             class="centered-image"
             id="expandingImage">
    </div>

    <div class="stars-container" id="starsContainer">
        <!-- I 5 layer di stelle verranno creati dinamicamente -->
    </div>
    <div id="spaceship"></div>

    <script>
        const startButton = document.getElementById('startButton');
        const imageContainer = document.getElementById('imageContainer');
        const expandingImage = document.getElementById('expandingImage');
        const starsContainer = document.getElementById('starsContainer');
        const spaceship = document.getElementById('spaceship');

        let audioContext = null;
        let isDragging = false;
        let dragStartX, dragStartY;
        let spaceshipX, spaceshipY;
        let centerX, centerY;
        let animationId = null;
        
        // Configurazione dei 5 layer di stelle
        const starLayers = [
            { 
                count: 400, 
                sizeMin: 1, 
                sizeMax: 1.5, 
                speed: 0.05, 
                opacity: 0.6,
                color: '#ffffff'
            },
            { 
                count: 300, 
                sizeMin: 1.2, 
                sizeMax: 2, 
                speed: 0.1, 
                opacity: 0.7,
                color: '#f0f0f0'
            },
            { 
                count: 200, 
                sizeMin: 1.5, 
                sizeMax: 2.5, 
                speed: 0.15, 
                opacity: 0.8,
                color: '#e8e8e8'
            },
            { 
                count: 150, 
                sizeMin: 2, 
                sizeMax: 3, 
                speed: 0.2, 
                opacity: 0.9,
                color: '#e0e0e0'
            },
            { 
                count: 100, 
                sizeMin: 2.5, 
                sizeMax: 4, 
                speed: 0.25, 
                opacity: 1,
                color: '#ffffff'
            }
        ];

        let starPositions = [];

        // Calcola il centro dello schermo
        function calculateCenter() {
            centerX = window.innerWidth / 2;
            centerY = window.innerHeight / 2;
        }

        // Funzione per creare i layer di stelle
        function createStars() {
            starsContainer.innerHTML = '';
            starPositions = [];
            
            starLayers.forEach((layer, layerIndex) => {
                const layerElement = document.createElement('div');
                layerElement.className = 'star-layer';
                layerElement.style.zIndex = layerIndex + 1;
                
                const fragment = document.createDocumentFragment();
                
                for (let i = 0; i < layer.count; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    
                    // Posizione casuale
                    const left = Math.random() * 100;
                    const top = Math.random() * 100;
                    
                    // Dimensione casuale in base al layer
                    const size = layer.sizeMin + Math.random() * (layer.sizeMax - layer.sizeMin);
                    
                    // Salva la posizione originale per il movimento
                    starPositions.push({
                        element: star,
                        originalLeft: left,
                        originalTop: top,
                        speed: layer.speed,
                        layer: layerIndex
                    });
                    
                    // Applica le proprietà
                    star.style.left = left + '%';
                    star.style.top = top + '%';
                    star.style.width = size + 'px';
                    star.style.height = size + 'px';
                    star.style.background = layer.color;
                    star.style.opacity = layer.opacity;
                    
                    // Animazione di scintillio casuale
                    const duration = 2 + Math.random() * 4;
                    const delay = Math.random() * 5;
                    star.style.animation = `twinkle ${duration}s infinite ${delay}s`;
                    
                    fragment.appendChild(star);
                }
                
                layerElement.appendChild(fragment);
                starsContainer.appendChild(layerElement);
            });
        }

        // Funzione per calcolare la velocità in base alla posizione della navicella
        function calculateVelocity() {
            if (!spaceshipX || !spaceshipY) return { x: 0, y: 0 };
            
            // Calcola la distanza dal centro (0 al centro, 1 ai bordi)
            const maxDistance = Math.min(centerX, centerY);
            const distanceX = (spaceshipX - centerX) / maxDistance;
            const distanceY = (spaceshipY - centerY) / maxDistance;
            
            // Calcola la velocità in base alla distanza (più vicino al centro = meno velocità)
            const speed = Math.min(1, Math.sqrt(distanceX * distanceX + distanceY * distanceY));
            
            // Direzione del movimento (opposta alla posizione della navicella)
            return {
                x: -distanceX * speed,
                y: -distanceY * speed
            };
        }

        // Funzione per aggiornare la posizione delle stelle
        function updateStarPositions() {
            const velocity = calculateVelocity();
            
            // Se non c'è movimento, non aggiornare le stelle
            if (velocity.x === 0 && velocity.y === 0) return;
            
            // Aggiorna ogni stella con la velocità del suo layer
            starPositions.forEach(star => {
                const layerSpeed = star.speed;
                const moveX = velocity.x * layerSpeed * 2;
                const moveY = velocity.y * layerSpeed * 2;
                
                // Applica lo spostamento alla posizione originale
                let newLeft = (parseFloat(star.originalLeft) + moveX) % 100;
                let newTop = (parseFloat(star.originalTop) + moveY) % 100;
                
                // Gestisce il wraparound delle stelle
                if (newLeft < 0) newLeft += 100;
                if (newLeft > 100) newLeft -= 100;
                if (newTop < 0) newTop += 100;
                if (newTop > 100) newTop -= 100;
                
                // Aggiorna la posizione della stella
                star.element.style.left = newLeft + '%';
                star.element.style.top = newTop + '%';
                
                // Aggiorna la posizione originale per il movimento continuo
                star.originalLeft = newLeft;
                star.originalTop = newTop;
            });
        }

        // Loop di animazione per il movimento continuo delle stelle
        function animateStars() {
            updateStarPositions();
            animationId = requestAnimationFrame(animateStars);
        }

        // Ferma l'animazione delle stelle
        function stopAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        // Funzione per creare e riprodurre il suono
        function createAndPlaySound() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(330, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1320, audioContext.currentTime + 2.5);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 3);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 3);
                
            } catch (error) {
                console.log('Audio non disponibile:', error);
            }
        }

        // Funzione per inizializzare la navicella
        function initSpaceship() {
            calculateCenter();
            spaceshipX = centerX;
            spaceshipY = centerY;
            
            spaceship.style.left = (spaceshipX - 20) + 'px';
            spaceship.style.top = (spaceshipY - 20) + 'px';
            spaceship.style.display = 'block';
            
            // Avvia l'animazione delle stelle
            animateStars();
            
            // Aggiungi event listeners per il drag
            spaceship.addEventListener('mousedown', startDrag);
            spaceship.addEventListener('touchstart', startDrag);
        }

        // Funzione per iniziare il drag
        function startDrag(e) {
            isDragging = true;
            
            if (e.type === 'touchstart') {
                dragStartX = e.touches[0].clientX - spaceshipX;
                dragStartY = e.touches[0].clientY - spaceshipY;
                
                document.addEventListener('touchmove', drag);
                document.addEventListener('touchend', stopDrag);
            } else {
                dragStartX = e.clientX - spaceshipX;
                dragStartY = e.clientY - spaceshipY;
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
            }
            
            e.preventDefault();
        }

        // Funzione per il drag
        function drag(e) {
            if (!isDragging) return;
            
            let clientX, clientY;
            
            if (e.type === 'touchmove') {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            // Calcola la nuova posizione
            spaceshipX = clientX - dragStartX;
            spaceshipY = clientY - dragStartY;
            
            // Mantieni la navicella dentro i bordi
            spaceshipX = Math.max(20, Math.min(window.innerWidth - 20, spaceshipX));
            spaceshipY = Math.max(20, Math.min(window.innerHeight - 20, spaceshipY));
            
            // Aggiorna la posizione della navicella
            spaceship.style.left = (spaceshipX - 20) + 'px';
            spaceship.style.top = (spaceshipY - 20) + 'px';
        }

        // Funzione per fermare il drag
        function stopDrag() {
            isDragging = false;
            
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchmove', drag);
            document.removeEventListener('touchend', stopDrag);
        }

        // Funzione per avviare l'esperienza
        function startExperience() {
            startButton.style.display = 'none';
            imageContainer.classList.add('visible');
            expandingImage.classList.add('expanding');
            
            createAndPlaySound();
            createStars();
            
            setTimeout(() => {
                imageContainer.classList.remove('visible');
                starsContainer.classList.add('visible');
                initSpaceship();
            }, 3000);
        }

        // Inizializza le stelle all'avvio
        createStars();
        calculateCenter();

        // Aggiunge l'event listener al pulsante
        startButton.addEventListener('click', startExperience);
        startButton.addEventListener('touchend', startExperience);

        // Previene completamente lo scrolling
        document.body.addEventListener('touchmove', function(e) {
            if (!isDragging) e.preventDefault();
        }, { passive: false });

        // Previene il zoom su doppio tap
        document.addEventListener('touchend', function (event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        let lastTouchEnd = 0;

        // Adatta l'altezza al viewport
        function adjustSize() {
            document.body.style.height = window.innerHeight + 'px';
            document.body.style.width = window.innerWidth + 'px';
            
            calculateCenter();
            
            if (spaceship.style.display !== 'none') {
                // Riposiziona la navicella mantenendo la proporzione rispetto al centro
                const relativeX = spaceshipX - centerX;
                const relativeY = spaceshipY - centerY;
                
                calculateCenter(); // Ricalcola il nuovo centro
                
                spaceshipX = centerX + relativeX;
                spaceshipY = centerY + relativeY;
                
                // Mantieni dentro i bordi
                spaceshipX = Math.max(20, Math.min(window.innerWidth - 20, spaceshipX));
                spaceshipY = Math.max(20, Math.min(window.innerHeight - 20, spaceshipY));
                
                spaceship.style.left = (spaceshipX - 20) + 'px';
                spaceship.style.top = (spaceshipY - 20) + 'px';
            }
        }

        window.addEventListener('resize', adjustSize);
        window.addEventListener('orientationchange', adjustSize);
        
        adjustSize();

        // Pre-carica l'immagine
        const img = new Image();
        img.src = 'https://raw.githubusercontent.com/retegramnews24/Spacehunt/main/square.PNG';
    </script>
</body>
</html>
