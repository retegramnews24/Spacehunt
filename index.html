<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spacehunt</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            border: 3px solid #003366;
            background: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
        }

        #startButton {
            padding: 20px 40px;
            font-size: 24px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s;
            font-family: Arial, sans-serif;
        }

        #startButton:active {
            transform: scale(0.95);
        }

        .image-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
        }

        .centered-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
        }

        .stars-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s;
        }

        .star-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
        }

        #spaceship {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #ff9900;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            box-shadow: 0 0 10px #ff9900;
            z-index: 100;
            display: none;
            cursor: move;
            transition: transform 0.1s;
        }

        #spaceship::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ffcc00;
            border-radius: 50%;
            top: 10px;
            left: 10px;
        }

        /* Titolo Space Hunt */
        #gameTitle {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Arial Black', 'Arial Bold', sans-serif;
            font-size: 36px;
            color: transparent;
            text-shadow: 
                0 0 10px #ff00ff,
                0 0 20px #ff00ff,
                0 0 30px #ff00ff,
                0 0 40px #00ffff,
                0 0 70px #00ffff,
                0 0 80px #00ffff;
            z-index: 200;
            display: none;
            letter-spacing: 3px;
            filter: blur(0.5px);
            animation: neonPulse 2s infinite alternate;
        }

        @keyframes neonPulse {
            from {
                text-shadow: 
                    0 0 10px #ff00ff,
                    0 0 20px #ff00ff,
                    0 0 30px #ff00ff,
                    0 0 40px #00ffff,
                    0 0 70px #00ffff,
                    0 0 80px #00ffff;
            }
            to {
                text-shadow: 
                    0 0 5px #ff00ff,
                    0 0 10px #ff00ff,
                    0 0 15px #ff00ff,
                    0 0 20px #00ffff,
                    0 0 35px #00ffff,
                    0 0 40px #00ffff;
            }
        }

        /* Punteggio LCD senza bordo */
        #scoreDisplay {
            position: absolute;
            top: 20px;
            right: 20px;
            font-family: 'Courier New', monospace;
            font-size: 28px;
            color: #00ff00;
            background: transparent;
            padding: 5px 10px;
            z-index: 200;
            display: none;
            text-shadow: 0 0 10px #00ff00;
            font-weight: bold;
            letter-spacing: 2px;
        }

        /* Timer */
        #timer {
            position: absolute;
            top: 20px;
            left: 20px;
            font-family: 'Courier New', monospace;
            font-size: 28px;
            color: #00ff00;
            background: transparent;
            padding: 5px 10px;
            z-index: 200;
            display: none;
            text-shadow: 0 0 10px #00ff00;
            font-weight: bold;
            letter-spacing: 2px;
        }

        /* Schermata Game Over */
        #gameOver {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        #gameOver h2 {
            font-size: 48px;
            color: #ff0000;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #ff0000;
        }

        #gameOver p {
            font-size: 24px;
            margin-bottom: 15px;
        }

        #restartButton {
            padding: 15px 30px;
            font-size: 20px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        #restartButton:active {
            transform: scale(0.95);
        }

        /* Asteroidi - 5 diverse grandezze */
        .asteroid {
            position: absolute;
            border-radius: 50%;
            z-index: 50;
            background-size: cover;
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Tipi di asteroidi con dimensioni e colori diversi */
        .asteroid.type1 { 
            background: radial-gradient(circle at 30% 30%, #888888, #333333);
            box-shadow: 0 0 5px #888888;
        } /* Piccolo - 5 punti */
        
        .asteroid.type2 { 
            background: radial-gradient(circle at 30% 30%, #996633, #553311);
            box-shadow: 0 0 8px #996633;
        } /* Medio - 10 punti */
        
        .asteroid.type3 { 
            background: radial-gradient(circle at 30% 30%, #774422, #331100);
            box-shadow: 0 0 10px #774422;
        } /* Grande - 15 punti */
        
        .asteroid.type4 { 
            background: radial-gradient(circle at 30% 30%, #663300, #221100);
            box-shadow: 0 0 12px #663300;
        } /* Molto Grande - 20 punti */
        
        .asteroid.type5 { 
            background: radial-gradient(circle at 30% 30%, #552200, #110000);
            box-shadow: 0 0 15px #552200;
        } /* Enorme - 25 punti */

        /* Oggetti da raccogliere - ora si muovono come le meteoriti */
        .collectible {
            position: absolute;
            border-radius: 50%;
            z-index: 60;
            animation: rotate 8s linear infinite;
        }

        /* Tipi di oggetti con colori diversi */
        .collectible.type1 { background: #ff0000; box-shadow: 0 0 10px #ff0000; } /* 10 punti */
        .collectible.type2 { background: #00ff00; box-shadow: 0 0 10px #00ff00; } /* 20 punti */
        .collectible.type3 { background: #0000ff; box-shadow: 0 0 10px #0000ff; } /* 50 punti */
        .collectible.type4 { background: #ffff00; box-shadow: 0 0 10px #ffff00; } /* 100 punti */
        .collectible.type5 { background: #ff00ff; box-shadow: 0 0 10px #ff00ff; } /* 200 punti */

        /* Animazioni */
        @keyframes expandAndFade {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            70% {
                transform: scale(3);
                opacity: 0.8;
            }
            100% {
                transform: scale(5);
                opacity: 0;
            }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .expanding {
            animation: expandAndFade 3s ease-in-out forwards;
        }

        .visible {
            opacity: 1 !important;
        }

        /* Previene lo zoom su doppio tap */
        * {
            touch-action: manipulation;
        }

        /* Ottimizzazioni per mobile */
        @media (max-width: 768px) {
            #gameTitle {
                font-size: 28px;
                top: 10px;
            }
            
            #scoreDisplay, #timer {
                font-size: 20px;
                top: 10px;
            }
            
            #spaceship {
                width: 30px;
                height: 30px;
            }
            
            #spaceship::after {
                width: 15px;
                height: 15px;
                top: 7.5px;
                left: 7.5px;
            }
        }
    </style>
</head>
<body>
    <button id="startButton">START</button>
    
    <div class="image-container" id="imageContainer">
        <img src="https://raw.githubusercontent.com/retegramnews24/Spacehunt/main/square.PNG" 
             alt="Spacehunt" 
             class="centered-image"
             id="expandingImage">
    </div>

    <div class="stars-container" id="starsContainer">
        <!-- I 5 layer di stelle verranno creati dinamicamente -->
    </div>
    
    <div id="spaceship"></div>
    <div id="gameTitle">SPACE HUNT</div>
    <div id="scoreDisplay">00050</div>
    <div id="timer">00:00</div>
    
    <div id="gameOver">
        <h2>GAME OVER</h2>
        <p id="finalTime">Tempo: 00:00</p>
        <p id="finalScore">Punteggio Finale: 0</p>
        <p id="maxScore">Punteggio Massimo: 0</p>
        <button id="restartButton">Restart</button>
    </div>

    <script>
        const startButton = document.getElementById('startButton');
        const imageContainer = document.getElementById('imageContainer');
        const expandingImage = document.getElementById('expandingImage');
        const starsContainer = document.getElementById('starsContainer');
        const spaceship = document.getElementById('spaceship');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const gameTitle = document.getElementById('gameTitle');
        const timerDisplay = document.getElementById('timer');
        const gameOverScreen = document.getElementById('gameOver');
        const finalTimeDisplay = document.getElementById('finalTime');
        const finalScoreDisplay = document.getElementById('finalScore');
        const maxScoreDisplay = document.getElementById('maxScore');
        const restartButton = document.getElementById('restartButton');

        let audioContext = null;
        let isDragging = false;
        let dragStartX, dragStartY;
        let spaceshipX, spaceshipY;
        let centerX, centerY;
        let animationId = null;
        let score = 50; // Punteggio iniziale di 50
        let maxScore = 50; // Punteggio massimo, inizializzato a 50
        let gameActive = false;
        let meteorMultiplier = 1; // Moltiplicatore per il numero di meteoriti
        let lastDifficultyUpdate = 0; // Punteggio dell'ultimo aggiornamento difficoltà
        
        // Variabili per il timer
        let startTime = 0;
        let timerInterval = null;
        let elapsedTime = 0;
        
        // Configurazione dei 5 layer di stelle - RIDOTTO per mobile
        const starLayers = [
            { 
                count: 150, // Ridotto da 400
                sizeMin: 1, 
                sizeMax: 1.5, 
                speed: 0.05, 
                opacity: 0.6,
                color: '#ffffff'
            },
            { 
                count: 100, // Ridotto da 300
                sizeMin: 1.2, 
                sizeMax: 2, 
                speed: 0.1, 
                opacity: 0.7,
                color: '#f0f0f0'
            },
            { 
                count: 80, // Ridotto da 200
                sizeMin: 1.5, 
                sizeMax: 2.5, 
                speed: 0.15, 
                opacity: 0.8,
                color: '#e8e8e8'
            },
            { 
                count: 60, // Ridotto da 150
                sizeMin: 2, 
                sizeMax: 3, 
                speed: 0.2, 
                opacity: 0.9,
                color: '#e0e0e0'
            },
            { 
                count: 40, // Ridotto da 100
                sizeMin: 2.5, 
                sizeMax: 4, 
                speed: 0.25, 
                opacity: 1,
                color: '#ffffff'
            }
        ];

        // Configurazione dei 5 tipi di asteroidi
        const asteroidTypes = [
            { 
                type: 1, 
                sizeMin: 10,
                sizeMax: 30,
                speedMin: 1.5, 
                speedMax: 2.5, 
                damage: 5 
            }, // Piccolo
            { 
                type: 2, 
                sizeMin: 15,
                sizeMax: 45,
                speedMin: 1.2, 
                speedMax: 2, 
                damage: 10 
            }, // Medio
            { 
                type: 3, 
                sizeMin: 20,
                sizeMax: 60,
                speedMin: 1, 
                speedMax: 1.8, 
                damage: 15 
            }, // Grande
            { 
                type: 4, 
                sizeMin: 25,
                sizeMax: 75,
                speedMin: 0.8, 
                speedMax: 1.5, 
                damage: 20 
            }, // Molto Grande
            { 
                type: 5, 
                sizeMin: 30,
                sizeMax: 90,
                speedMin: 0.6, 
                speedMax: 1.2, 
                damage: 25 
            }  // Enorme
        ];

        // Configurazione per i punti colorati (collectibles)
        const collectibleTypes = [
            { 
                type: 1, 
                score: 10, 
                speedMin: 0.8, 
                speedMax: 1.5,
                sizeMin: 6,
                sizeMax: 18
            },
            { 
                type: 2, 
                score: 20, 
                speedMin: 0.7, 
                speedMax: 1.4,
                sizeMin: 7,
                sizeMax: 21
            },
            { 
                type: 3, 
                score: 50, 
                speedMin: 0.6, 
                speedMax: 1.3,
                sizeMin: 8,
                sizeMax: 24
            },
            { 
                type: 4, 
                score: 100, 
                speedMin: 0.5, 
                speedMax: 1.2,
                sizeMin: 9,
                sizeMax: 27
            },
            { 
                type: 5, 
                score: 200, 
                speedMin: 0.4, 
                speedMax: 1.1,
                sizeMin: 10,
                sizeMax: 30
            }
        ];

        let starPositions = [];
        let asteroids = [];
        let collectibles = [];
        let asteroidInterval = null;
        let collectibleInterval = null;

        // Calcola il centro dello schermo
        function calculateCenter() {
            centerX = window.innerWidth / 2;
            centerY = window.innerHeight / 2;
        }

        // Aggiorna il display del punteggio
        function updateScoreDisplay() {
            scoreDisplay.textContent = String(score).padStart(5, '0');
            
            // Aggiorna il punteggio massimo se necessario
            if (score > maxScore) {
                maxScore = score;
            }
            
            updateDifficulty();
            
            // Controlla se il gioco è finito (punteggio <= 0)
            if (score <= 0 && gameActive) {
                endGame();
            }
        }

        // Aggiorna la difficoltà ogni 1000 punti
        function updateDifficulty() {
            const difficultyLevel = Math.floor(score / 1000);
            
            if (difficultyLevel > lastDifficultyUpdate) {
                lastDifficultyUpdate = difficultyLevel;
                meteorMultiplier = 1 + (difficultyLevel * 0.25); // Aumenta del 25% ogni 1000 punti
                
                // Effetto visivo per indicare aumento difficoltà
                const originalColor = scoreDisplay.style.color;
                scoreDisplay.style.color = '#ff0000';
                setTimeout(() => {
                    scoreDisplay.style.color = originalColor;
                }, 500);
            }
        }

        // Funzione per formattare il tempo in minuti e secondi
        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // Avvia il timer
        function startTimer() {
            startTime = Date.now() - elapsedTime;
            timerInterval = setInterval(() => {
                elapsedTime = Date.now() - startTime;
                timerDisplay.textContent = formatTime(elapsedTime);
            }, 1000);
        }

        // Ferma il timer
        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Funzione per creare i layer di stelle
        function createStars() {
            starsContainer.innerHTML = '';
            starPositions = [];
            
            starLayers.forEach((layer, layerIndex) => {
                const layerElement = document.createElement('div');
                layerElement.className = 'star-layer';
                layerElement.style.zIndex = layerIndex + 1;
                
                const fragment = document.createDocumentFragment();
                
                for (let i = 0; i < layer.count; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    
                    // Posizione casuale
                    const left = Math.random() * 100;
                    const top = Math.random() * 100;
                    
                    // Dimensione casuale in base al layer
                    const size = layer.sizeMin + Math.random() * (layer.sizeMax - layer.sizeMin);
                    
                    // Salva la posizione originale per il movimento
                    starPositions.push({
                        element: star,
                        originalLeft: left,
                        originalTop: top,
                        speed: layer.speed,
                        layer: layerIndex
                    });
                    
                    // Applica le proprietà
                    star.style.left = left + '%';
                    star.style.top = top + '%';
                    star.style.width = size + 'px';
                    star.style.height = size + 'px';
                    star.style.background = layer.color;
                    star.style.opacity = layer.opacity;
                    
                    // Animazione di scintillio casuale
                    const duration = 2 + Math.random() * 4;
                    const delay = Math.random() * 5;
                    star.style.animation = `twinkle ${duration}s infinite ${delay}s`;
                    
                    fragment.appendChild(star);
                }
                
                layerElement.appendChild(fragment);
                starsContainer.appendChild(layerElement);
            });
        }

        // Funzione per calcolare la velocità in base alla posizione della navicella
        function calculateVelocity() {
            if (!spaceshipX || !spaceshipY) return { x: 0, y: 0 };
            
            // Calcola la distanza dal centro (0 al centro, 1 ai bordi)
            const maxDistance = Math.min(centerX, centerY);
            const distanceX = (spaceshipX - centerX) / maxDistance;
            const distanceY = (spaceshipY - centerY) / maxDistance;
            
            // Calcola la velocità in base alla distanza (più vicino al centro = meno velocità)
            const speed = Math.min(1, Math.sqrt(distanceX * distanceX + distanceY * distanceY));
            
            // Direzione del movimento (opposta alla posizione della navicella)
            return {
                x: -distanceX * speed,
                y: -distanceY * speed
            };
        }

        // Funzione per aggiornare la posizione delle stelle
        function updateStarPositions() {
            const velocity = calculateVelocity();
            
            // Se non c'è movimento, non aggiornare le stelle
            if (velocity.x === 0 && velocity.y === 0) return;
            
            // Aggiorna ogni stella con la velocità del suo layer
            starPositions.forEach(star => {
                const layerSpeed = star.speed;
                const moveX = velocity.x * layerSpeed * 2;
                const moveY = velocity.y * layerSpeed * 2;
                
                // Applica lo spostamento alla posizione originale
                let newLeft = (parseFloat(star.originalLeft) + moveX) % 100;
                let newTop = (parseFloat(star.originalTop) + moveY) % 100;
                
                // Gestisce il wraparound delle stelle
                if (newLeft < 0) newLeft += 100;
                if (newLeft > 100) newLeft -= 100;
                if (newTop < 0) newTop += 100;
                if (newTop > 100) newTop -= 100;
                
                // Aggiorna la posizione della stella
                star.element.style.left = newLeft + '%';
                star.element.style.top = newTop + '%';
                
                // Aggiorna la posizione originale per il movimento continuo
                star.originalLeft = newLeft;
                star.originalTop = newTop;
            });
        }

        // Crea un asteroide
        function createAsteroid() {
            if (!gameActive) return;
            
            // RIDOTTO: Calcola quanti asteroidi creare in base al moltiplicatore (8 base invece di 16)
            const asteroidCount = Math.floor(8 * meteorMultiplier);
            
            for (let i = 0; i < asteroidCount; i++) {
                const asteroid = document.createElement('div');
                asteroid.className = 'asteroid';
                
                // Sceglie casualmente un tipo di asteroide
                const asteroidType = asteroidTypes[Math.floor(Math.random() * asteroidTypes.length)];
                asteroid.classList.add('type' + asteroidType.type);
                
                // Dimensione casuale nell'intervallo aumentato del 100%
                const size = asteroidType.sizeMin + Math.random() * (asteroidType.sizeMax - asteroidType.sizeMin);
                
                // Posizione iniziale casuale ai bordi dello schermo
                const side = Math.floor(Math.random() * 4); // 0: top, 1: right, 2: bottom, 3: left
                let left, top;
                
                switch(side) {
                    case 0: // top
                        left = Math.random() * 100;
                        top = -10;
                        break;
                    case 1: // right
                        left = 110;
                        top = Math.random() * 100;
                        break;
                    case 2: // bottom
                        left = Math.random() * 100;
                        top = 110;
                        break;
                    case 3: // left
                        left = -10;
                        top = Math.random() * 100;
                        break;
                }
                
                // Velocità casuale in base al tipo di asteroide
                const speed = asteroidType.speedMin + Math.random() * (asteroidType.speedMax - asteroidType.speedMin);
                
                // Direzione costante (non cambia più)
                const angle = Math.random() * Math.PI * 2;
                const velocityX = Math.cos(angle) * speed;
                const velocityY = Math.sin(angle) * speed;
                
                asteroid.style.width = size + 'px';
                asteroid.style.height = size + 'px';
                asteroid.style.left = left + '%';
                asteroid.style.top = top + '%';
                
                document.body.appendChild(asteroid);
                
                asteroids.push({
                    element: asteroid,
                    x: left,
                    y: top,
                    size: size,
                    velocityX: velocityX,
                    velocityY: velocityY,
                    damage: asteroidType.damage
                });
            }
        }

        // Crea un oggetto da raccogliere (punti colorati)
        function createCollectible() {
            if (!gameActive) return;
            
            // Crea 2 punti colorati invece di 1 (aumento del 100%)
            for (let j = 0; j < 2; j++) {
                const collectible = document.createElement('div');
                collectible.className = 'collectible';
                
                // Tipo casuale (1-5)
                const typeIndex = Math.floor(Math.random() * collectibleTypes.length);
                const collectibleType = collectibleTypes[typeIndex];
                collectible.classList.add('type' + collectibleType.type);
                
                // Dimensione casuale nell'intervallo aumentato del 100%
                const size = collectibleType.sizeMin + Math.random() * (collectibleType.sizeMax - collectibleType.sizeMin);
                
                // Posizione iniziale casuale ai bordi dello schermo (come le meteoriti)
                const side = Math.floor(Math.random() * 4); // 0: top, 1: right, 2: bottom, 3: left
                let left, top;
                
                switch(side) {
                    case 0: // top
                        left = Math.random() * 100;
                        top = -5;
                        break;
                    case 1: // right
                        left = 105;
                        top = Math.random() * 100;
                        break;
                    case 2: // bottom
                        left = Math.random() * 100;
                        top = 105;
                        break;
                    case 3: // left
                        left = -5;
                        top = Math.random() * 100;
                        break;
                }
                
                // Velocità casuale in base al tipo di collectible
                const speed = collectibleType.speedMin + Math.random() * (collectibleType.speedMax - collectibleType.speedMin);
                
                // Direzione costante (come le meteoriti)
                const angle = Math.random() * Math.PI * 2;
                const velocityX = Math.cos(angle) * speed;
                const velocityY = Math.sin(angle) * speed;
                
                collectible.style.width = size + 'px';
                collectible.style.height = size + 'px';
                collectible.style.left = left + '%';
                collectible.style.top = top + '%';
                
                document.body.appendChild(collectible);
                
                collectibles.push({
                    element: collectible,
                    x: left,
                    y: top,
                    type: 'type' + collectibleType.type,
                    score: collectibleType.score,
                    velocityX: velocityX,
                    velocityY: velocityY
                });
            }
        }

        // Aggiorna la posizione degli asteroidi (movimento lineare)
        function updateAsteroids() {
            for (let i = asteroids.length - 1; i >= 0; i--) {
                const asteroid = asteroids[i];
                
                // Muovi l'asteroide con velocità costante
                asteroid.x += asteroid.velocityX;
                asteroid.y += asteroid.velocityY;
                
                // Aggiorna la posizione
                asteroid.element.style.left = asteroid.x + '%';
                asteroid.element.style.top = asteroid.y + '%';
                
                // Rimuovi se fuori dallo schermo
                if (asteroid.x < -20 || asteroid.x > 120 || asteroid.y < -20 || asteroid.y > 120) {
                    asteroid.element.remove();
                    asteroids.splice(i, 1);
                }
            }
        }

        // Aggiorna la posizione dei punti colorati (movimento lineare come le meteoriti)
        function updateCollectibles() {
            for (let i = collectibles.length - 1; i >= 0; i--) {
                const collectible = collectibles[i];
                
                // Muovi il collectible con velocità costante
                collectible.x += collectible.velocityX;
                collectible.y += collectible.velocityY;
                
                // Aggiorna la posizione
                collectible.element.style.left = collectible.x + '%';
                collectible.element.style.top = collectible.y + '%';
                
                // Rimuovi se fuori dallo schermo
                if (collectible.x < -10 || collectible.x > 110 || collectible.y < -10 || collectible.y > 110) {
                    collectible.element.remove();
                    collectibles.splice(i, 1);
                }
            }
        }

        // Funzione semplificata per rilevare collisioni (ottimizzata per mobile)
        function checkCollisions() {
            // Ottieni i bounds reali della navicella
            const shipRect = spaceship.getBoundingClientRect();
            const shipCenterX = shipRect.left + shipRect.width / 2;
            const shipCenterY = shipRect.top + shipRect.height / 2;
            const shipRadius = shipRect.width / 2;
            
            // Controlla collisioni con asteroidi
            for (let i = asteroids.length - 1; i >= 0; i--) {
                const asteroid = asteroids[i];
                const asteroidRect = asteroid.element.getBoundingClientRect();
                const asteroidCenterX = asteroidRect.left + asteroidRect.width / 2;
                const asteroidCenterY = asteroidRect.top + asteroidRect.height / 2;
                const asteroidRadius = asteroidRect.width / 2;
                
                // Calcola la distanza tra i centri
                const dx = shipCenterX - asteroidCenterX;
                const dy = shipCenterY - asteroidCenterY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // Se la distanza è minore della somma dei raggi, c'è collisione
                if (distance < shipRadius + asteroidRadius) {
                    // Collisione con asteroide - toglie punti in base alla grandezza
                    playCollisionSound();
                    score = Math.max(0, score - asteroid.damage);
                    updateScoreDisplay();
                    asteroid.element.remove();
                    asteroids.splice(i, 1);
                }
            }
            
            // Controlla collisioni con oggetti da raccogliere
            for (let i = collectibles.length - 1; i >= 0; i--) {
                const collectible = collectibles[i];
                const collectibleRect = collectible.element.getBoundingClientRect();
                const collectibleCenterX = collectibleRect.left + collectibleRect.width / 2;
                const collectibleCenterY = collectibleRect.top + collectibleRect.height / 2;
                const collectibleRadius = collectibleRect.width / 2;
                
                // Calcola la distanza tra i centri
                const dx = shipCenterX - collectibleCenterX;
                const dy = shipCenterY - collectibleCenterY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // Se la distanza è minore della somma dei raggi, c'è collisione
                if (distance < shipRadius + collectibleRadius) {
                    // Raccolta oggetto
                    playCollectSound();
                    score += collectible.score;
                    updateScoreDisplay();
                    collectible.element.remove();
                    collectibles.splice(i, 1);
                }
            }
        }

        // Loop di animazione per il movimento continuo delle stelle
        function gameLoop() {
            if (!gameActive) return;
            
            updateStarPositions();
            updateAsteroids();
            updateCollectibles();
            checkCollisions();
            animationId = requestAnimationFrame(gameLoop);
        }

        // Ferma l'animazione delle stelle
        function stopAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        // Suono per collisione con asteroide
        function playCollisionSound() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(100, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
                
            } catch (error) {
                console.log('Audio non disponibile:', error);
            }
        }

        // Suono per raccolta oggetto
        function playCollectSound() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // Do
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // Mi
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // Sol
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.4);
                
            } catch (error) {
                console.log('Audio non disponibile:', error);
            }
        }

        // Funzione per creare e riprodurre il suono iniziale
        function createAndPlaySound() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(330, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1320, audioContext.currentTime + 2.5);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 3);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 3);
                
            } catch (error) {
                console.log('Audio non disponibile:', error);
            }
        }

        // Funzione per terminare il gioco
        function endGame() {
            gameActive = false;
            stopTimer();
            stopAnimation();
            
            // Ferma la generazione di asteroidi e punti colorati
            clearInterval(asteroidInterval);
            clearInterval(collectibleInterval);
            
            // Nascondi gli elementi di gioco
            spaceship.style.display = 'none';
            scoreDisplay.style.display = 'none';
            timerDisplay.style.display = 'none';
            gameTitle.style.display = 'none';
            
            // Mostra la schermata di game over
            finalTimeDisplay.textContent = `Tempo: ${formatTime(elapsedTime)}`;
            finalScoreDisplay.textContent = `Punteggio Finale: ${score}`;
            maxScoreDisplay.textContent = `Punteggio Massimo: ${maxScore}`;
            gameOverScreen.style.display = 'flex';
        }

        // Funzione per riavviare il gioco
        function restartGame() {
            // Nascondi la schermata di game over
            gameOverScreen.style.display = 'none';
            
            // Rimuovi tutti gli asteroidi e punti colorati
            asteroids.forEach(asteroid => asteroid.element.remove());
            asteroids = [];
            collectibles.forEach(collectible => collectible.element.remove());
            collectibles = [];
            
            // Resetta le variabili di gioco
            score = 50;
            maxScore = 50; // Resetta anche il punteggio massimo
            meteorMultiplier = 1;
            lastDifficultyUpdate = 0;
            elapsedTime = 0;
            
            // Ripristina gli elementi di gioco
            scoreDisplay.style.display = 'block';
            timerDisplay.style.display = 'block';
            gameTitle.style.display = 'block';
            updateScoreDisplay();
            timerDisplay.textContent = '00:00';
            
            // Riavvia il gioco
            startExperience();
        }

        // Funzione per inizializzare la navicella
        function initSpaceship() {
            calculateCenter();
            spaceshipX = centerX;
            spaceshipY = centerY;
            
            spaceship.style.left = (spaceshipX - 20) + 'px';
            spaceship.style.top = (spaceshipY - 20) + 'px';
            spaceship.style.display = 'block';
            
            // Avvia l'animazione delle stelle
            gameActive = true;
            gameLoop();
            
            // Avvia la generazione di asteroidi e oggetti
            asteroidInterval = setInterval(createAsteroid, 2000); // Ogni 2 secondi
            collectibleInterval = setInterval(createCollectible, 3000); // Ogni 3 secondi
            
            // Avvia il timer
            startTimer();
            
            // Aggiungi event listeners per il drag
            spaceship.addEventListener('mousedown', startDrag);
            spaceship.addEventListener('touchstart', startDrag);
        }

        // Funzione per iniziare il drag
        function startDrag(e) {
            isDragging = true;
            
            if (e.type === 'touchstart') {
                dragStartX = e.touches[0].clientX - spaceshipX;
                dragStartY = e.touches[0].clientY - spaceshipY;
                
                document.addEventListener('touchmove', drag);
                document.addEventListener('touchend', stopDrag);
            } else {
                dragStartX = e.clientX - spaceshipX;
                dragStartY = e.clientY - spaceshipY;
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
            }
            
            e.preventDefault();
        }

        // Funzione per il drag
        function drag(e) {
            if (!isDragging) return;
            
            let clientX, clientY;
            
            if (e.type === 'touchmove') {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            // Calcola la nuova posizione
            spaceshipX = clientX - dragStartX;
            spaceshipY = clientY - dragStartY;
            
            // Mantieni la navicella dentro i bordi
            spaceshipX = Math.max(20, Math.min(window.innerWidth - 20, spaceshipX));
            spaceshipY = Math.max(20, Math.min(window.innerHeight - 20, spaceshipY));
            
            // Aggiorna la posizione della navicella
            spaceship.style.left = (spaceshipX - 20) + 'px';
            spaceship.style.top = (spaceshipY - 20) + 'px';
        }

        // Funzione per fermare il drag
        function stopDrag() {
            isDragging = false;
            
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchmove', drag);
            document.removeEventListener('touchend', stopDrag);
        }

        // Funzione per avviare l'esperienza
        function startExperience() {
            startButton.style.display = 'none';
            imageContainer.classList.add('visible');
            expandingImage.classList.add('expanding');
            
            createAndPlaySound();
            createStars();
            
            setTimeout(() => {
                imageContainer.classList.remove('visible');
                starsContainer.classList.add('visible');
                scoreDisplay.style.display = 'block';
                gameTitle.style.display = 'block';
                timerDisplay.style.display = 'block';
                updateScoreDisplay();
                initSpaceship();
            }, 3000);
        }

        // Inizializza le stelle all'avvio
        createStars();
        calculateCenter();

        // Aggiunge l'event listener al pulsante
        startButton.addEventListener('click', startExperience);
        startButton.addEventListener('touchend', startExperience);

        // Aggiunge l'event listener al pulsante di riavvio
        restartButton.addEventListener('click', restartGame);

        // Previene completamente lo scrolling
        document.body.addEventListener('touchmove', function(e) {
            if (!isDragging) e.preventDefault();
        }, { passive: false });

        // Previene il zoom su doppio tap
        document.addEventListener('touchend', function (event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        let lastTouchEnd = 0;

        // Adatta l'altezza al viewport
        function adjustSize() {
            document.body.style.height = window.innerHeight + 'px';
            document.body.style.width = window.innerWidth + 'px';
            
            calculateCenter();
            
            if (spaceship.style.display !== 'none') {
                // Riposiziona la navicella mantenendo la proporzione rispetto al centro
                const relativeX = spaceshipX - centerX;
                const relativeY = spaceshipY - centerY;
                
                calculateCenter(); // Ricalcola il nuovo centro
                
                spaceshipX = centerX + relativeX;
                spaceshipY = centerY + relativeY;
                
                // Mantieni dentro i bordi
                spaceshipX = Math.max(20, Math.min(window.innerWidth - 20, spaceshipX));
                spaceshipY = Math.max(20, Math.min(window.innerHeight - 20, spaceshipY));
                
                spaceship.style.left = (spaceshipX - 20) + 'px';
                spaceship.style.top = (spaceshipY - 20) + 'px';
            }
        }

        window.addEventListener('resize', adjustSize);
        window.addEventListener('orientationchange', adjustSize);
        
        adjustSize();

        // Pre-carica l'immagine
        const img = new Image();
        img.src = 'https://raw.githubusercontent.com/retegramnews24/Spacehunt/main/square.PNG';
    </script>
</body>
</html>
